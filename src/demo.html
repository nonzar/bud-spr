<!DOCTYPE html>
<html lang="zh-cn" ng-app="app">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link href="css/bootstrap.min.css" rel="stylesheet"/>
    <link href="css/global.css" rel="stylesheet"/>
    <link href="css/angular-ui-grid/ui-grid.css" rel="stylesheet"/>
</head>
<body>
<div ng-controller="MainCtrl">
    <div ui-grid="gridOptions" ui-grid-pagination class="grid"></div>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/angular.min-1.5.10.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/ui-grid.min.js"></script>
<script>
    var app = angular.module("app", ['ui.grid', 'ui.grid.pagination']);
    app.controller('MainCtrl', ['$scope', '$http', 'uiGridConstants', function ($scope, $http, uiGridConstants) {
        var paginationOptions = {
            pageNumber: 1,
            pageSize: 50,
            sort: null
        };
        $scope.gridOptions = {
            paginationPageSizes: [50],
            paginationPageSize: 50,
            useExternalPagination: true,
            useExternalSorting: true,
            columnDefs: [
                {name: 'id'},
                {name: 'openId', enableSorting: false}
            ],
            onRegisterApi: function (gridApi) {
                $scope.gridApi = gridApi;
                $scope.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                    if (sortColumns.length == 0) {
                        paginationOptions.sort = null;
                    } else {
                        paginationOptions.sort = sortColumns[0].sort.direction;
                    }
                    getPage();
                });
                gridApi.pagination.on.paginationChanged($scope, function (newPage, pageSize) {
                    paginationOptions.pageNumber = newPage;
                    paginationOptions.pageSize = pageSize;
                    getPage();
                });
            }
        };

        var getPage = function () {
            console.log(uiGridConstants);
            $.post("http://120.77.53.178/baiwei/baiweistat.php/home/index/qscore", {
                spr: 862094
            }, function (data) {
                console.log(data = JSON.parse(data));
                $scope.gridOptions.totalItems = data.data.totalpages - 1;
                $scope.gridOptions.data = function (data, arr) {
                    for (var i = 0; i < data.data.data.length; i++) {
                        arr.push({
                            "id": parseInt(data.data.data[i].id),
                            "openId": data.data.data[i].openid
                        });
                    }
                    return arr;
                }(data, []);
            });
        };
        getPage();
    }]);
    //            $.post("http://120.77.53.178/baiwei/baiweistat.php/home/index/qscore", {
    //                spr: 862094
    //            }, function (data) {
    //                data = JSON.parse(data);
    //                console.log(data);
    //                $scope.gridApi.data = function (data, arr) {
    //                    for (var i = 0; i < data.data.data.length; i++) {
    //                        arr.push({
    //                            "id": parseInt(data.data.data[i].id),
    //                            "openId": data.data.data[i].openid
    //                        });
    //                    }
    //                    return arr;
    //                }(data, []);
    //            });
</script>
</body>
</html>